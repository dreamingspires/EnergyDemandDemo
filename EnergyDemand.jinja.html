<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <link rel="stylesheet" type="text/css" href="sliders.css">
    <title>EnergyDemand</title>
</head>
<body style="background-color: #f0f0f5">
<!--<div class="columns">-->
<!--    <div class="column">-->
<div class="tile is-ancestor">
    <div class="tile is parent is-vertical is-6 notification" style="background-color: #f0f0f5">
        <div class="tile is-child">
            <label class="label"> Choose zone</label>
            <div class="control is-expanded">
                <div class="select is-fullwidth">
                    <select id="zone" onchange="refreshZone();">
                    </select>
                </div>
            </div>
            <div>
                <label class="label" style = "width: 50%;">Energy Tariff</label>

                <div class="slidecontainer">
                    <div class="level">
                        <div class = "level-item"><div class = "label">Standard</div></div>
                        <div class="level-item">
                            <input type="range" min="1" max="100" value="50" class="slider" id="slider1">
                        </div>
                        <div class = "level-item"><div class = "label">Economy</div></div>
                        <div class="level-item">
                            <input type="text" id="slider1Text" value="">
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <div class = "label" style="font-size: large">Electric Vehicles penetration</div>
            <div>
                <label class="label" style = "width: 100%;">2-Wheeler</label>

                <div class="slidecontainer">
                    <div class="level">
                        <div class = "level-item"><div class = "label">0</div></div>
                        <div class="level-item">
                            <input type="range" min="1" max="100" value="50" class="slider" id="slider2">
                        </div>
                        <div class = "level-item"><div class = "label">100</div></div>
                        <div class="level-item">
                            <input type="text" id="slider2Text" value="">
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <label class="label" style = "width: 100%;">Compact vehicles</label>

                <div class="slidecontainer">
                    <div class="level">
                        <div class = "level-item"><div class = "label">0</div></div>
                        <div class="level-item">
                            <input type="range" min="1" max="100" value="50" class="slider" id="slider3">
                        </div>
                        <div class = "level-item"><div class = "label">100</div></div>
                        <div class="level-item">
                            <input type="text" id="slider3Text" value="">
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <label class="label" style = "width: 100%;">Large vehicles</label>

                <div class="slidecontainer">
                    <div class="level">
                        <div class = "level-item"><div class = "label">0</div></div>
                        <div class="level-item">
                            <input type="range" min="1" max="100" value="50" class="slider" id="slider4">
                        </div>
                        <div class = "level-item"><div class = "label">100</div></div>
                        <div class="level-item">
                            <input type="text" id="slider4Text" value="">
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <label class="label" style = "width: 100%;">SUVs</label>

                <div class="slidecontainer">
                    <div class="level">
                        <div class = "level-item"><div class = "label">0</div></div>
                        <div class="level-item">
                            <input type="range" min="1" max="100" value="50" class="slider" id="slider5">
                        </div>
                        <div class = "level-item"><div class = "label">100</div></div>
                        <div class="level-item">
                            <input type="text" id="slider5Text" value="">
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <div class = "label" style="font-size: large">Percentage of individuals working from home</div>
            <div>
                <div class="slidecontainer">
                    <div class="level">
                        <div class = "level-item"><div class = "label">0</div></div>
                        <div class="level-item">
                            <input type="range" min="1" max="100" value="50" class="slider" id="slider6">
                        </div>
                        <div class = "level-item"><div class = "label">100</div></div>
                        <div class="level-item">
                            <input type="text" id="slider6Text" value="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <article class="tile is-child">
            <div class="container mt-6">
                <div class="button is-large is-inverted is-fullwidth has-text-black" onclick="startSim();"
                     style="background-color: dodgerblue ">RUN THE SIMULATION
                </div>
            </div>
            <div class="level">
                <div class="level-left">
                    <div class="level-item">
                        <div class="field">
                            <div class="control">
                                <div class="button is-fullwidth" id="setFed" style="background-color: #B22222">(1)
                                    Settings
                                    fed
                                </div>
                            </div>
                            <div class="control">
                                <div class="button is-fullwidth" id="pop" style="background-color: #B22222">(2)
                                    Population synthesis
                                </div>
                            </div>
                            <div class="control">
                                <div class="button is-fullwidth" id="time" style="background-color: #B22222">(3) Time
                                    use
                                    synthesis
                                </div>
                            </div>
                            <div class="control">
                                <div class="button is-fullwidth" id="energy" style="background-color: #B22222">(4)
                                    Energy
                                    demand
                                </div>
                            </div>
                            <div class="control">
                                <div class="button is-fullwidth" id="report" style="background-color: #b22222">(5)
                                    Reporting
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="field">
                        <div class="box">
                            <div class="button is-fullwidth" id ="setLay" style="background-color: #B22222">SETUP LAYER</div>

                            <div class="level mb-0">
                                <div class="level-item">
                                    <i class="fas fa-long-arrow-alt-down fa-3x" id = "ar1" style="color: #B22222"></i>
                                </div>
                                <div class="level-item">
                                    <i class="fas fa-long-arrow-alt-down fa-3x" id = "ar2" style="color: #B22222"></i>
                                </div>
                                <div class="level-item">
                                    <i class="fas fa-long-arrow-alt-down fa-3x" id = "ar3" style="color: #B22222"></i>
                                </div>
                            </div>

                            <div class="level">
                                <div class="level-item">
                                    <div class="button" id = "pop2" style="background-color: #B22222">Population synthesis</div>
                                </div>
                                <div class="level-item">
                                    <i class="fas fa-long-arrow-alt-right fa-3x" id = "ar4" style="color: #B22222"></i>
                                </div>

                                <div class="level-item">
                                    <div class="button" id = "time2" style="background-color: #B22222">Time use synthesis</div>
                                </div>
                                <div class="level-item">
                                    <i class="fas fa-long-arrow-alt-right fa-3x" id = "ar5" style="color: #B22222"></i>
                                </div>
                                <div class="level-item">
                                    <div class="button" id = "energy2" style="background-color: #B22222">Energy demand</div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>

        </article>
    </div>
    <!--        </div>-->
    <!--    </div>-->


    <!--    <div class="column">-->
    <!--        <div class="tile is-ancestor">-->
    <div class="tile is parent is-vertical is-6 notification" style="background-color: #f0f0f5">
        <div class="tile is-child" id="mapCon">
            <div class="container" style="position: relative;height: 100%; width: 100%">

                <div class="box" id="box" style="z-index: 3; position: absolute; visibility: hidden;">
                    <div class="box" style="width: auto;height: auto">
                        <div class="columns">
                            <div class="column">
                                <p id="population"></p>
                                <p id="numOfHouses"></p>
                                <p id="IncomeDist"></p>
                                <p>Percentage of household living in:</p>
                                <p id="flat"></p>
                                <p id="house"></p>
                            </div>
                            <div class="column has-text-centered">
                                <canvas id="chartDet"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class = "container" style="position: relative;  text-align: center;">
                <img src="map.png" style="z-index: 1;max-width:100%; max-height:100%;object-fit: fill"/>
                <div class="button is-large" id="mapA"
                     style="border-radius: 50%; z-index: 2; position: absolute; left: 22%; top: 33%; background-color: rgba(248,203,173,0.0); border:hidden">
                    Zone A
                </div>
                <div class="button is-large" id="mapB"
                     style="border-radius: 50%;  z-index: 2; position: absolute; left: 44%; top: 11%; background-color: rgba(143,170,220,0.0); border:hidden">
                    Zone B
                </div>
                <div class="button is-large" id="mapC"
                     style="border-radius: 50%;  z-index: 2; position: absolute; left: 55%; top: 22%; background-color: rgba(197,224,180,0.0); border:hidden">
                    Zone C
                </div>
                <div class="button is-large" id="mapD"
                     style="border-radius: 50%;  z-index: 2; position: absolute; left: 22%; top: 55%; background-color: rgba(0,176,240,0.0); border:hidden">
                    Zone D
                </div>
                <div class="button is-large" id="mapE"
                     style="border-radius: 50%;  z-index: 2; position: absolute; left: 52%; top: 55%; background-color: rgba(255,242,204,0.0); border:hidden">
                    Zone E
                </div>
                <div class="button is-large" id="mapF"
                     style="border-radius: 50%;  z-index: 2; position: absolute; left: 65%; top: 44%; background-color: rgba(217,217,217,0.0); border:hidden">
                    Zone F
                </div>

                </div>


            </div>
        </div>
        <div class="tile is-child">
            <canvas id="chart">
            </canvas>
        </div>
    </div>
</div>

<!--    </div>-->

<!--</div>-->

<div class="modal" id="modal">
    <div class="modal-background" id="bg" style="opacity: 0"></div>
</div>
<script>
    function sleep(ms) {
        console.log("sleep");
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    function restartSim() {
        var setFed = document.getElementById("setFed");
        var pop = document.getElementById("pop");
        var time = document.getElementById("time");
        var energy = document.getElementById("energy");
        var report = document.getElementById("report");

        var ar1 = document.getElementById("ar1");
        var ar2 = document.getElementById("ar2");
        var ar3 = document.getElementById("ar3");
        var ar4 = document.getElementById("ar4");
        var ar5 = document.getElementById("ar5");
        var setLay = document.getElementById("setLay");
        var pop2 = document.getElementById("pop2");
        var time2 = document.getElementById("time2");
        var energy2 = document.getElementById("energy2");



        setFed.style.backgroundColor = "#B22222";
        setLay.style.backgroundColor = "#B22222";

        ar1.style.color = "#B22222";
        ar2.style.color = "#B22222";
        ar3.style.color = "#B22222";
        ar4.style.color = "#B22222";
        ar5.style.color = "#B22222";

        pop.style.backgroundColor = "#B22222";
        pop2.style.backgroundColor = "#B22222";

        time.style.backgroundColor = "#B22222";
        time2.style.backgroundColor = "#B22222";


        energy.style.backgroundColor = "#B22222";
        energy2.style.backgroundColor = "#B22222";

        report.style.backgroundColor = "#B22222";


    }

    async function startSim() {
        var setFed = document.getElementById("setFed");
        var pop = document.getElementById("pop");
        var time = document.getElementById("time");
        var energy = document.getElementById("energy");
        var report = document.getElementById("report");

        var ar1 = document.getElementById("ar1");
        var ar2 = document.getElementById("ar2");
        var ar3 = document.getElementById("ar3");
        var ar4 = document.getElementById("ar4");
        var ar5 = document.getElementById("ar5");
        var setLay = document.getElementById("setLay");
        var pop2 = document.getElementById("pop2");
        var time2 = document.getElementById("time2");
        var energy2 = document.getElementById("energy2");

        setFed.style.backgroundColor = "#4CAF50";
        setLay.style.backgroundColor = "#4CAF50";
        ar1.style.color = "#4CAF50";
        ar2.style.color = "#4CAF50";
        ar3.style.color = "#4CAF50";
        await sleep(1000);
        pop.style.backgroundColor = "#4CAF50";
        pop2.style.backgroundColor = "#4CAF50";
        ar4.style.color = "#4CAF50";
        await sleep(1000);
        time.style.backgroundColor = "#4CAF50";
        time2.style.backgroundColor = "#4CAF50";
        ar5.style.color = "#4CAF50";
        await sleep(1000);
        energy.style.backgroundColor = "#4CAF50";
        energy2.style.backgroundColor = "#4CAF50";
        await sleep(1000);
        report.style.backgroundColor = "#4CAF50";
        await sleep(1000);
        refreshChart();
    }

    var dfs = {{ dfs |safe }};

    var zone_desc = {
        "A": [92, 15, 6, 3, 2, 21, 3743, 1251, 29, 24, 16, 18, 6, 7, 17, 83],
        "B": [86, 12, 4, 11, 6, 10, 9521, 3233, 30, 26, 14, 18, 6, 5, 19, 81],
        "C": [73, 5, 10, 17, 14, 70, 2009, 667, 28, 24, 11, 14, 11, 12, 15, 85],
        "D": [77, 2, 1, 1, 0, 10, 6408, 2134, 24, 35, 13, 19, 6, 3, 18, 82],
        "E": [89, 18, 6, 2, 5, 50, 2592, 898, 41, 23, 19, 12, 4, 1, 13, 81],
        "F": [55, 15, 10, 16, 15, 40, 6720, 2215, 22, 37, 21, 9, 3, 8, 22, 78]
    }
    var lineChart = null;

    var zones = Object.keys(dfs);
    var selectBoxZone = document.getElementById('zone');

    for (var i = 0, l = zones.length; i < l; i++) {
        var option = zones[i];
        selectBoxZone.options.add(new Option(option, option));
    }


    function refreshZone() {
        if(lineChart!=null)
            lineChart.destroy();
        refreshSliders();
        restartSim();

    }

    function refreshSliders() {
        var zone = document.getElementById('zone').value;

        var slidersVals = Object.values(zone_desc[zone]);
        console.log(slidersVals);


        for (var i = 0; i < 6; i++) {
            var sliderId = "slider";
            var slider = document.getElementById(sliderId + (i + 1));
            console.log(sliderId + (i + 1));
            slider.value = slidersVals[i];
            var sliderText = document.getElementById(sliderId + (i + 1) + "Text");
            sliderText.value = slidersVals[i] + "%";
            slider.disabled = true;
            sliderText.disabled = true;
        }

    }

    function refreshChart() {
        console.log("chart");
        var zone = document.getElementById('zone').value;

        var dates = Object.values(dfs[zone]["DT"]);
        var vals = Object.values(dfs[zone]["EnDemProfile"]);

        dates = dates.map(function(x){
            return x.slice(10);
        })

        var chart = document.getElementById('chart').getContext('2d');

        if (lineChart != null)
            lineChart.destroy();

        lineChart = new Chart(chart, {
            type: 'line',

            data: {
                datasets: [{
                    label: "Zone " + zone,
                    data: vals,
                    backgroundcolor: "Black"
                }],
                labels: dates
            }
            ,
            options: {
                title: {
                    display: true,
                    text: 'ENERGY DEMAND',
                    fontSize: 24
                },
                legend: {
                    position: 'right'
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: "Kilowatt",
                            fontSize: 18
                        },
                    }],
                    xAxes: [{
                        gridLines: {
                            display: true
                        }
                    }]
                },
                elements: {
                    point: {
                        radius: 0
                    }
                }
            }
        });
    }

    //modals

    var box = document.getElementById('box');
    var modal = document.getElementById('modal');
    var bg = document.getElementById('bg');

    var mapA = document.getElementById('mapA');
    var mapB = document.getElementById('mapB');
    var mapC = document.getElementById('mapC');
    var mapD = document.getElementById('mapD');
    var mapE = document.getElementById('mapE');
    var mapF = document.getElementById('mapF');


    var chart = null;

    function fillModal(z) {
        var zone = z;

        var pop = document.getElementById('population');
        var num = document.getElementById('numOfHouses');
        var inc = document.getElementById('IncomeDist');
        var flats = document.getElementById('flat');
        var houses = document.getElementById('house');


        pop.innerText = "Income distribution:\n" + "Population: " + zone_desc[zone][6];
        num.innerText = "Number of households: " + zone_desc[zone][7];
        inc.innerText = "Below £15k p.a.: " + zone_desc[zone][8] + "%\n" +
            "£15-25k p.a.: " + zone_desc[zone][9] + "%\n" +
            "£25k-35k p.a.: " + zone_desc[zone][10] + "%\n" +
            "£35-50k p.a.: " + zone_desc[zone][11] + "%\n" +
            "£50-70k p.a.: " + zone_desc[zone][12] + "%\n" +
            "Above £70k p.a.: " + zone_desc[zone][13] + "%\n"
        var lineChart = document.getElementById('chartDet').getContext('2d');

        if (chart != null)
            chart.destroy();
        chart = new Chart(lineChart, {
            type: 'line',
            data: {
                datasets: [{
                    label: "Zone " + zone + " Income distribution",
                    data: [zone_desc[zone][8], zone_desc[zone][9], zone_desc[zone][10], zone_desc[zone][11], zone_desc[zone][12], zone_desc[zone][13]],
                    backgroundcolor: "Black"
                }],
                labels: ["Below £15k p.a.", "£15-25k p.a.", "£25k-35k p.a.", "£35-50k p.a.", "£50-70k p.a.", "Above £70k p.a."]
            },
            options: {
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: "% of people",
                            fontSize: 12
                        }
                    }]
                }
            }


        })
        flats.innerText = "flats: " + zone_desc[zone][14] + '%'
        houses.innerText = "houses: " + zone_desc[zone][15] + '%'


    }

    mapA.addEventListener('click', () => {
        var z = mapA.id.charAt(3);
        fillModal(z);
        console.log('clicked');
        box.style.visibility = "visible";
        modal.classList.add('is-active');
    })
    mapB.addEventListener('click', () => {
        var z = mapB.id.charAt(3);
        fillModal(z);
        console.log('clicked');
        box.style.visibility = "visible";
        modal.classList.add('is-active');
    })
    mapC.addEventListener('click', () => {
        var z = mapC.id.charAt(3);
        fillModal(z);
        console.log('clicked');
        box.style.visibility = "visible";
        modal.classList.add('is-active');
    })
    mapD.addEventListener('click', () => {
        var z = mapD.id.charAt(3);
        fillModal(z);
        console.log('clicked');
        box.style.visibility = "visible";
        modal.classList.add('is-active');
    })
    mapE.addEventListener('click', () => {
        var z = mapE.id.charAt(3);
        fillModal(z);
        console.log('clicked');
        box.style.visibility = "visible";
        modal.classList.add('is-active');
    })
    mapF.addEventListener('click', () => {
        var z = mapF.id.charAt(3);
        fillModal(z);
        console.log('clicked');
        box.style.visibility = "visible";
        modal.classList.add('is-active');
    })
    bg.addEventListener("click", () => {
        box.style.visibility = "hidden";
        modal.classList.remove('is-active')
    });
    refreshZone();

</script>

</body>
</html>
